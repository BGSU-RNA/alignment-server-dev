{% extends "layout.html" %}
{%- block title %}
    <title>{% block titletext %}Sequence Variation Results{% endblock titletext %}</title>
{%- endblock title %}
{%- block head %}
    <style type="text/css">
    .sequence {
      font-family: Consolas, monospace;
    }
    .right {
      text-align: right;
    }
    .requested {
      background-color: #ccffcc;
    }
    .reference {
      background-color: #9999ff;
    }
    </style>
{%- endblock head %}
{% block body %}
      <h2>{{ self.titletext() }}</h2>
      <p>TO DO:</p>
      <ul>
        <li>display the ranges that created the output</li>
        <li>"download as text" button option (tab-separated)</li>
        <li>filter box (see the Non-Redundant Sets and Motif Atlas pages</li>
        <li>consider making the header repetition interval user-selectable (an
          additional variable at submission time, and minor retooling)</li>
        <li>consider making the "Lineage Name" a mouseover (or similar
          construct) associated with the "Scientific Name" (to conserve a great
          deal of space per row of the table; may need the header repeats less
          often then)</li>
        <li>filter columns that are empty in all sequences from output
          (database-side issue, whether on-the-fly or alignment-related)</li>
      </ul>
      <hr>
      <h3>Sequence Summary</h3>
      <table border="1">
        <caption>Green background indicates sequence present in chosen PDB
          file.</caption>
        <thead>
          {%- block summary_header %}
          <tr>
            <th>Complete Fragment</th>
            <th>Number of Appearances</th>
          </tr>
          {% endblock summary_header -%}
        </thead>
        <tbody>
          {%- block rowbuild scoped %}
            {%- for line in reqs %}
              {% set seqid = line['SeqID'] %}
              {% set seqvr = line['SeqVersion'] %}
              {% set requested = line['CompleteFragment'] %}

              {%- for row in summ %}
                {%- if requested == row['CompleteFragment'] %}
                  {%- set fragclass = 'sequence requested' %}
                  {%- set appsclass = 'right requested' %}
                {%- else %}
                  {%- set fragclass = 'sequence' %}
                  {%- set appsclass = 'right' %}
                {%- endif %}
          <tr>
            <td class="{{fragclass}}">{{ row['CompleteFragment'] }}</td>
            <td class="{{appsclass}}">{{ row['NumberOfAppearances'] }}</td>
          </tr>
              {%- endfor %}
            {%- endfor %}
          {%- endblock rowbuild %}
        </tbody>
        <tfoot>{{ self.summary_header() }}</tfoot>
      </table>
      <hr>
      <h3>Sequence Details</h3>
      <table border="1" width="100%">
        <caption>Real data from rCAD (unless run in debug mode, with two lines of
          sample data); header repeated every 20 rows.  Multiple ranges (if
          requested) are separated by commas.
          <br/><br/>
          Green background (for sequence) indicates the sequence present in
          chosen PDB file.  For the actual entry found in the chosen PDB file,
          the entire row has a light blue background (IN PROGRESS).
        </caption>
        <thead>
          {% block results_header %}
          <tr>
            <th>SeqID</th>
            <th>SeqVersion</th>
            <th>CompleteFragment</th>
            <th>AccessionID</th>
            <th>TaxID</th>
            <th>ScientificName</th>
            <th>LineageName</th>
          </tr>
          {% endblock results_header %}
        </thead>
        <tbody>
          {# Iterate over full.  Put another copy of results_header every n
            rows.  What value of n (trying 20)? #}

          {%- block resbuild scoped %}
            {%- for item in reqs %}
              {% set seqid = item['SeqID'] %}
              {% set seqvr = item['SeqVersion'] %}
              {% set requested = item['CompleteFragment'] %}

              {% for row in full %}
                {%- set fragclass = 'sequence requested' if requested ==
                  row['CompleteFragment'] else 'sequence' %}
                {%- set rowclass = 'reference' if ( seqid == row['SeqID'] and
                  seqvr == row['SeqVersion'] ) else '' %}
          <tr class="{{rowclass}}">
            <td>{{ row['SeqID'] }}</td>
            <td>{{ row['SeqVersion'] }}</td>
            <td class="{{fragclass}}">{{ row['CompleteFragment'] }}</td>
            <td>{{ row['AccessionID'] }}</td>
            <td>{{ row['TaxID'] }}</td>
            <td>{{ row['ScientificName'] }}</td>
            <td>{{ row['LineageName'] }}</td>
          </tr>
                {% if loop.index is divisibleby(20) %}
        </tbody>
        <tbody>
              {{ self.results_header() }}
        </tbody>
        <tbody>
                {% endif %}
              {% endfor %}
            {%- endfor %}
          {% endblock resbuild %}
        </tbody>
        <tfoot>
          {{ self.results_header() }}
        </tfoot>
      </table>
{% endblock body %}
