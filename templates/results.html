{% extends "layout.html" %}
{%- block title %}
    <title>{% block titletext %}Sequence Variation Results{% endblock titletext %}</title>
{%- endblock title %}
{%- block head %}
    <style type="text/css">
    .sequence {
      font-family: Consolas, monospace;
    }
    .right {
      text-align: right;
    }
    .requested {
      background-color: #ccffcc;
    }
    .reference {
      background-color: #9999ff;
    }
    </style>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.4/css/jquery.dataTables.css">
    <!-- ColVis CSS (DataTables extension) -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/colvis/1.1.1/css/dataTables.colVis.css">
    <!-- TableTools CSS (DataTables extension) -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css">
    {%- endblock head %}
{% block body %}
      <h2>{{ self.titletext() }}</h2>
      {# <p>TESTING:</p>
      <ul>
        <li>DataTables:
          <ul>
            <li>Pagination for "Sequence Summary"</li>
            <li>Scrolling for "Sequence Details"</li>
            <li>Download options for "Sequence Details" (not working yet)</li>
            <li>Search/filter functions for both tables</li>
            <li>Initially hide the "LineageName" column to keep the display narrow</li>
          </ul>
        </li>
      </ul>
      <p>TO DO:</p>
      <ul>
        <li><font color="blue">SEE ABOVE: DataTables tools for pagination, sorting, filtering, <em>etc.</em></font></li>
        <li><font color="blue">SEE ABOVE: download as text" button option (tab-separated)</font></li>
        <li><font color="blue">SEE ABOVE: filter box (see the Non-Redundant Sets and Motif Atlas pages</font></li>
        <li>Bootstrap formatting to match form page</li>
        <li>display the ranges that created the output</li>
        <li>filter columns that are empty in all sequences from output
          (database-side issue, whether on-the-fly or alignment-related)</li>
      </ul>
      #}
      <hr>
      <h3>Sequence Summary</h3>
      <table border="1" id="sequence_summary" name="sequence_summary">
        <caption>Green background indicates sequence present in chosen PDB
          file.</caption>
        <thead>
          {%- block summary_header %}
          <tr>
            <th>Complete Fragment</th>
            <th>Number of Occurances</th>
          </tr>
          {% endblock summary_header -%}
        </thead>
        <tfoot>{{ self.summary_header() }}</tfoot>
        <tbody>
          {%- block rowbuild scoped %}
            {%- for line in reqs %}
              {%- set seqid = line['SeqID'] %}
              {%- set seqvr = line['SeqVersion'] %}
              {%- set requested = line['CompleteFragment'] %}

              {%- for row in summ %}
                {%- if requested == row['CompleteFragment'] %}
                  {%- set fragclass = 'sequence requested' %}
                  {%- set appsclass = 'right requested' %}
                {%- else %}
                  {%- set fragclass = 'sequence' %}
                  {%- set appsclass = 'right' %}
                {%- endif %}
          <tr>
            <td class="{{fragclass}}">{{ row['CompleteFragment'] }}</td>
            <td class="{{appsclass}}">{{ row['NumberOfAppearances'] }}</td>
          </tr>
              {%- endfor %}
            {%- endfor %}
          {%- endblock rowbuild %}
        </tbody>
      </table>
      <hr>
      <h3>Sequence Details</h3>
      <table border="1" width="100%" id="sequence_details" name="sequence_details">
        <caption>Real data from rCAD (unless run in debug mode, with two lines of
          sample data).  Multiple ranges (if requested) are separated by commas.
          <br/><br/>
          Green background (for sequence) indicates the sequence present in
          chosen PDB file.  For the actual entry found in the chosen PDB file,
          the entire row has a light blue background.
        </caption>
        <thead>
          {% block results_header %}
          <tr>
            <th>Sequence&nbsp;#<br/>(CRW:&nbsp;ID.Version)</th>
            <th>Sequence</th>
            <th>GenBank&nbsp;Accession&nbsp;#</th>
            <th>TaxID&nbsp;(NCBI)</th>
            <th>Scientific&nbsp;Name</th>
            <th>Taxonomic&nbsp;Lineage</th>
          </tr>
          {% endblock results_header %}
        </thead>
        <tbody>
          {%- block resbuild scoped %}
            {%- for item in reqs %}
              {%- set seqid = item['SeqID'] %}
              {%- set seqvr = item['SeqVersion'] %}
              {%- set requested = item['CompleteFragment'] %}

              {%- for row in full %}
                {%- set rowclass = 'reference' if ( seqid == row['SeqID'] and
                  seqvr == row['SeqVersion'] ) else '' %}
                {%- set fragclass = 'sequence requested' if ( requested ==
                  row['CompleteFragment'] and rowclass == '' ) else 'sequence' %}
          <tr class="{{rowclass}}">
            <td class="{{rowclass}}">{{ row['SeqID'] }}.{{ row['SeqVersion'] }}</td>
            <td class="{{fragclass}} {{rowclass}}">{{ row['CompleteFragment'] }}</td>
            <td class="{{rowclass}}"><a href="http://www.ncbi.nlm.nih.gov/nuccore/{{ row['AccessionID'] }}?report=GenBank" target="_blank">{{ row['AccessionID'] }}</td>
            <td class="{{rowclass}}"><a href="http://www.ncbi.nlm.nih.gov/Taxonomy/Browser/wwwtax.cgi?id={{row['TaxID']}}" target="_blank">{{ row['TaxID'] }}</a></td>
            <td class="{{rowclass}}">{{ row['ScientificName'] }}</td>
            <td class="{{rowclass}}">{{ row['LineageName'] }}</td>
          </tr>
              {% endfor %}
            {%- endfor %}
          {% endblock resbuild %}
        </tbody>
        <tfoot>
          {{- self.results_header() }}
        </tfoot>
      </table>
{% endblock body %}

{%- block page_specific_js -%}
    <script src="{{ url_for('static', filename='js/results.js') }}"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.4/js/jquery.dataTables.js"></script>
    <!-- ColVis JS (DataTables extension) -->
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/colvis/1.1.1/js/dataTables.colVis.js"></script>
    <!-- TableTools JS (DataTables extension) -->
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.js"></script>
{%- endblock page_specific_js %}
